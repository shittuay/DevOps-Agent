# Penetration Testing Timeout Fix & Usage Guide

## Issue: Request Timeout (5 minutes)

If you received a timeout error like:
```
‚è±Ô∏è Request timeout: Your request took longer than 5 minutes to process.
```

This happened because comprehensive vulnerability scans can take a long time when running multiple tools sequentially.

---

## ‚úÖ Solution: Use Quick Vulnerability Scan

We've added a **new optimized tool** specifically designed to avoid timeouts: `quick_vulnerability_scan`

### How to Use

Instead of asking:
```
"scan this domain www.vibe-stream.online and find any vulnerabilities"
```

Try these optimized commands:

#### Option 1: Quick Web Scan (Recommended - 2-3 minutes)
```
"Run a quick vulnerability scan on www.vibe-stream.online for web vulnerabilities"
```

This performs:
- SSL/TLS security check
- Web server vulnerability scan (Nikto with limited checks)
- Results in 2-4 minutes

#### Option 2: Quick Network Scan (1-2 minutes)
```
"Run a quick network vulnerability scan on vibe-stream.online"
```

This performs:
- Port scan of top 100 ports
- Service detection
- Results in 1-3 minutes

#### Option 3: Comprehensive Quick Scan (3-5 minutes)
```
"Run a comprehensive quick vulnerability scan on www.vibe-stream.online"
```

This performs:
- Port scan of top 200 ports
- SSL/TLS check (if HTTPS is open)
- Web vulnerability scan (if HTTP/HTTPS is open)
- Results in 3-6 minutes

---

## Configuration Required

Before scanning, you need to:

### 1. Enable Pentest Tools

Edit `config/config.yaml`:

```yaml
pentest:
  enabled: true
  require_confirmation: true
```

### 2. Add Target to Whitelist

**IMPORTANT**: Only add domains/IPs you own or have written authorization to test!

```yaml
pentest:
  whitelisted_targets:
    - "vibe-stream.online"      # Your domain
    - "www.vibe-stream.online"  # With www prefix
    - "localhost"
    - "127.0.0.1"
```

### 3. Increase Timeout (Optional)

If you still get timeouts, increase the agent timeout in `config/config.yaml`:

```yaml
safety:
  command_timeout_seconds: 1800  # 30 minutes instead of 5
```

---

## Tool Comparison

| Tool | Duration | What it Scans | Best For |
|------|----------|---------------|----------|
| `quick_vulnerability_scan` (web) | 2-4 min | SSL + Web vulnerabilities | Web applications |
| `quick_vulnerability_scan` (network) | 1-3 min | Top 100 ports | Network services |
| `quick_vulnerability_scan` (comprehensive) | 3-6 min | Ports + Web + SSL | Full overview |
| `nmap_port_scan` (quick=true) | 1-2 min | Top 100 ports only | Quick port check |
| `nmap_port_scan` (default) | 10-15 min | Top 1000 ports | Thorough port scan |
| `nikto_web_scan` | 5-10 min | Full web server scan | Deep web testing |

---

## Example Conversation Flow

### Correct Usage:

```
User: "I want to check www.vibe-stream.online for security issues"

Agent: "I'll run a quick vulnerability scan. This will check SSL/TLS
configuration and scan for web vulnerabilities. This should complete
in 2-4 minutes."

[Agent runs quick_vulnerability_scan with scan_type='web']

Agent: "Scan complete! Found:
- SSL Grade: A
- 3 web vulnerabilities detected:
  1. Directory listing enabled
  2. X-Frame-Options header missing
  3. Apache version disclosure

Recommendations:
- Disable directory browsing
- Add security headers
- Update Apache version"
```

### Incorrect Usage (Will Timeout):

```
User: "scan this domain www.vibe-stream.online and find any vulnerabilities"

Agent: [Tries to run multiple tools: nmap full scan, nikto full scan,
       sqlmap, xss scan, ssl scan... all in sequence]

Result: ‚è±Ô∏è Timeout after 5 minutes
```

---

## Advanced Options

### If You Need Specific Scans

Instead of asking for a general scan, specify exactly what you need:

```
"Check the SSL certificate for vibe-stream.online"
‚Üí Uses ssl_scan (30 seconds)

"Scan top 100 ports on vibe-stream.online quickly"
‚Üí Uses nmap_port_scan with quick=true (1-2 minutes)

"Run Nikto on https://www.vibe-stream.online for misconfigurations only"
‚Üí Uses nikto_web_scan with tuning='2' (3-5 minutes)

"Test https://www.vibe-stream.online/login.php for SQL injection"
‚Üí Uses sqlmap_scan (5-10 minutes)
```

### For Multiple Scans

Break them into separate commands:

```
1. "Run a quick network scan on vibe-stream.online"
   [Wait for results]

2. "Now check the SSL configuration"
   [Wait for results]

3. "Finally, run a web vulnerability scan"
   [Wait for results]
```

---

## Timeout Settings Explained

The agent has multiple timeout layers:

1. **Tool Timeout**: Individual tools have their own timeouts
   - Quick nmap: 180 seconds (3 min)
   - Standard nmap: 600 seconds (10 min)
   - Full port scan: 1800 seconds (30 min)
   - Nikto: 3600 seconds (60 min)

2. **Command Timeout**: Overall command execution limit
   - Default: 300 seconds (5 minutes) ‚Üê **This is what caused your timeout**
   - Recommended: 1800 seconds (30 minutes)

3. **Request Timeout**: Claude API response timeout
   - Determined by Anthropic API limits

---

## Troubleshooting

### "Target not in whitelist"

**Error**: `Target not in whitelist: vibe-stream.online`

**Fix**: Add to `config/config.yaml`:
```yaml
pentest:
  whitelisted_targets:
    - "vibe-stream.online"
```

### "Pentest tools disabled"

**Error**: `Penetration testing disabled in configuration`

**Fix**: Enable in `config/config.yaml`:
```yaml
pentest:
  enabled: true
```

### "nmap not installed"

**Error**: `nmap not installed. Install with: apt-get install nmap`

**Fix**:
```bash
# Ubuntu/Debian
sudo apt-get install nmap

# macOS
brew install nmap

# Windows
# Download from: https://nmap.org/download.html
```

### "Still getting timeouts"

**Fix**:
1. Use `quick_vulnerability_scan` instead of general requests
2. Increase timeout in config.yaml to 1800 seconds
3. Run scans separately instead of all at once
4. Use quick=true parameter for nmap scans
5. Specify which scans you need instead of "all vulnerabilities"

---

## Best Practices

1. **Start with Quick Scans**: Always use quick scans first for an overview
2. **Be Specific**: Ask for specific scans rather than "find all vulnerabilities"
3. **Sequential not Parallel**: Run scans one at a time
4. **Check Authorization**: Ensure you have permission before scanning
5. **Review Whitelist**: Keep your whitelist up to date
6. **Monitor Progress**: Check logs if scans seem stuck
7. **Incremental Approach**: Start small, then go deeper if needed

---

## Quick Reference Commands

```bash
# Enable pentest in config
grep -A 5 "pentest:" config/config.yaml

# Add target to whitelist
# Edit config/config.yaml and add under whitelisted_targets:
# - "your-domain.com"

# Check if pentest tools are loaded
python main.py tools | grep -i "vulnerability\|nmap\|nikto"

# Run quick scan (after enabling pentest)
python main.py ask "Run a quick web vulnerability scan on www.example.com"

# View pentest audit logs
tail -f logs/pentest_audit.log
```

---

## Summary

**Problem**: General vulnerability scans timeout after 5 minutes

**Solution**: Use the new `quick_vulnerability_scan` tool:

```
"Run a quick vulnerability scan on [target] for web vulnerabilities"
```

This completes in 2-4 minutes with useful security findings!

**Remember**: Always ensure you have authorization before scanning any target! üîí
